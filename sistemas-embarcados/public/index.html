<!DOCTYPE html>

<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Monitoramento de Máquinas Elétricas</title>
    <style>
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th, td {
        padding: 5px;
        text-align: center;    
      }
      </style>
</head>
<body>
   <h2>Monitoramento de Máquinas Elétricas</h2>
  
   <table width="400px">
    <tr>
      <th colspan="7">variaveis da maquina</th>
    </tr>
    
    <tr>
      <th rowspan="2">aceleracao</td>
      <th colspan = "2"> x </th>
      <th colspan = "2"> y </th>
      <th colspan = "2"> z </th>
      
    </tr>
    <tr>
      <td colspan = "2" id="acc_x">?</td>
      <td colspan = "2" id="acc_y">?</td>
      <td colspan = "2" id="acc_z">?</td>
    </tr>
    
      <th >razao</td>
      <td colspan = "2" id="table_x">?</td>
      <td colspan = "2" id="table_y">?</td>
      <td colspan = "2" id="table_z">?</td>
    <tr>
      <th >media</td>
      <td colspan = "2" id="media_x">?</td>
      <td colspan = "2" id="media_y">?</td>
      <td colspan = "2" id="media_z">?</td>
    </tr>
    <tr>
      <th> desvio padrao</td>
      <td colspan = "2" id="desvio_x">?</th>
      <td colspan = "2" id="desvio_y">?</th>
      <td colspan = "2" id="desvio_z">?</th>
    </tr>
      <th> RMS</td>
      <td colspan = "2" id="rms_x">?</th>
      <td colspan = "2" id="rms_y">?</th>
      <td colspan = "2" id="rms_z">?</th> 
    </tr>
   </table>
   <div></div>

   <!-- The core Firebase JS SDK is always required and must be listed first -->
   <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>

   <!-- TODO: Add SDKs for Firebase products that you want to use
   https://firebase.google.com/docs/web/setup#config-web-app -->
   <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-database.js"></script>

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyBgU86JsRga_iiKS434hJXsMnRnW45XnXo",
        authDomain: "teste-f83e2.firebaseapp.com",
        databaseURL: "https://teste-f83e2.firebaseio.com",
        projectId: "teste-f83e2",
        storageBucket: "teste-f83e2.appspot.com",
        messagingSenderId: "492054886264",
        appId: "1:492054886264:web:bde095c8aa79f180" 
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      firebase.database.Reference
      var acc_x_Ref = firebase.database().ref('acc_x');
      var acc_y_Ref = firebase.database().ref('acc_y');
      var acc_z_Ref = firebase.database().ref('acc_z');
      var razao_x_Ref = firebase.database().ref('razao de pico X');
      var razao_y_Ref = firebase.database().ref('razao de pico Y');
      var razao_z_Ref = firebase.database().ref('razao de pico Z');
      var media_x_Ref = firebase.database().ref('media_x');
      var media_y_Ref = firebase.database().ref('media_y');
      var media_z_Ref = firebase.database().ref('media_z');
      var desvio_x_Ref = firebase.database().ref('desvio_x');
      var desvio_y_Ref = firebase.database().ref('desvio_y');
      var desvio_z_Ref = firebase.database().ref('desvio_z');
      var rms_x_Ref = firebase.database().ref('rmsx');
      var rms_y_Ref = firebase.database().ref('rmsy');
      var rms_z_Ref = firebase.database().ref('rmsz');
      var flag_x_Ref = firebase.database().ref('flagx');
      var flag_y_Ref = firebase.database().ref('flagy');;
      var flag_z_Ref = firebase.database().ref('flagz');;
      var razao_x;
      var razao_y;
      var razao_z;
      var media_x;
      var media_y;
      var media_z;
      var desvio_x;
      var desvio_y;
      var desvio_z;
      var rms_x;
      var rms_y;
      var rms_z;
      var acc_x;
      var acc_y;
      var acc_z;
      var flag_x;
      var flag_y;
      var flag_z;
      acc_x_Ref.on('value', function(snapshot){
        acc_x = snapshot.val();
        document.getElementById("acc_x").innerHTML = acc_x;})
      acc_y_Ref.on('value', function(snapshot){
        acc_y = snapshot.val();
        document.getElementById("acc_y").innerHTML = acc_y;})
      acc_z_Ref.on('value', function(snapshot){
        acc_z = snapshot.val();
        document.getElementById("acc_z").innerHTML = acc_z;})

      razao_x_Ref.on('value', function(snapshot){
        razao_x = snapshot.val();
        document.getElementById("table_x").innerHTML = razao_x;})
      
      razao_y_Ref.on('value', function(snapshot){
        razao_y = snapshot.val();
        document.getElementById("table_y").innerHTML = razao_y;}) 
      
      razao_z_Ref.on('value', function(snapshot){
        razao_z = snapshot.val();
        document.getElementById("table_z").innerHTML = razao_z;})

      media_x_Ref.on('value', function(snapshot){
        media_x = snapshot.val();
        document.getElementById("media_x").innerHTML = media_x;})
      
      media_y_Ref.on('value', function(snapshot){
        media_y = snapshot.val();
        document.getElementById("media_y").innerHTML = media_y;})

      media_z_Ref.on('value', function(snapshot){
        media_z = snapshot.val();
        document.getElementById("media_z").innerHTML = media_z;})
      
      desvio_x_Ref.on('value', function(snapshot){
        desvio_x = snapshot.val();
        document.getElementById("desvio_x").innerHTML = desvio_x;})

      desvio_y_Ref.on('value', function(snapshot){
        desvio_y = snapshot.val();
        document.getElementById("desvio_y").innerHTML = desvio_y;})

      desvio_z_Ref.on('value', function(snapshot){
        desvio_z = snapshot.val();
        document.getElementById("desvio_z").innerHTML = desvio_z;})

      rms_x_Ref.on('value', function(snapshot){
        rms_x = snapshot.val();
        document.getElementById("rms_x").innerHTML = rms_x;})

      rms_y_Ref.on('value', function(snapshot){
        rms_y = snapshot.val();
        document.getElementById("rms_y").innerHTML = rms_y;})

      rms_z_Ref.on('value', function(snapshot){
        rms_z = snapshot.val();
        document.getElementById("rms_z").innerHTML = rms_z;})

      flag_x_Ref.on('value', function(snapshot){
        flag_x = snapshot.val();
        if(flag_x) document.getElementById("table_x").style.color = "green";
        else document.getElementById("table_x").style.color = "red";
      })

      flag_y_Ref.on('value', function(snapshot){
        flag_y = snapshot.val();
        if(flag_y) document.getElementById("table_y").style.color = "green";
        else document.getElementById("table_y").style.color = "red";
      })

      flag_z_Ref.on('value', function(snapshot){
        flag_z = snapshot.val();
        if(flag_z) document.getElementById("table_z").style.color = "green";
        else document.getElementById("table_z").style.color = "red";
      })

      
      
      
      
        window.onload = function () {

          var dps = []; // dataPoints
          var dps1 = [];
          var dps2 = [];
          var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            title :{
              text: "razao de picos por amostras"
            },
            axisX: {
              valueFormatString: "###"
            },
            axisY: {
              title: "razao de picos",
              includeZero: true
            },
            toolTip:{
              shared: true
            },      
            data: [{
              name: "razao x",
              type: "spline",
              showInLegend: true,
		          dataPoints: dps
            },
            {
              name: "razao y",
              type: "spline",
              showInLegend: true,
		          dataPoints: dps1
            },
            {
              name: "razao z",
              type: "spline",
              showInLegend: true,
		          dataPoints: dps2
            }
            ]

          });

          var xVal = 0;
          var yValx; 
          var yValy;
          var yValz;
          var updateInterval = 100;
          var dataLength = 20; // number of dataPoints visible at any point

          var updateChart = function (count) {

            count = count || 1;

            for (var j = 0; j < count; j++) {
              yValx = razao_x ; 
              yValy = razao_y ;
              yValz = razao_z ;
              dps.push({
                x: xVal,
                y: yValx
              });
              dps1.push({
                x: xVal,
                y: yValy
              });
              dps2.push({
                x: xVal,
                y: yValz
              });
              xVal++;
            }

            if (dps.length > dataLength) {
              dps.shift();
              dps1.shift();
              dps2.shift();
            }

            chart.render();
          };

          updateChart(dataLength);
          setInterval(function(){updateChart()}, updateInterval);


          

        }

      
    </script>
  <div id="chartContainer" style="height: 300px; width: 100%;"></div>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>  
  </body>
</html>
